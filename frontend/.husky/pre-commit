echo "ğŸ” Running pre-commit checks..."
echo "ğŸ“ Current directory: $(pwd)"
echo "ğŸ“‹ Checking both main project and website subdirectory"

# Main project checks
echo ""
echo "ğŸ  === MAIN PROJECT CHECKS ==="
echo "ğŸ“ Running checks in main project directory"

# Run linting for main project
echo "ğŸ“ Checking main project code style with ESLint..."
npm run lint
if [ $? -ne 0 ]; then
  echo "âŒ Main project ESLint failed. Please fix the issues before committing."
  exit 1
fi
echo "âœ… Main project ESLint passed"

# Check code formatting for main project
echo "ğŸ¨ Checking main project code formatting with Prettier..."
npm run format:check
if [ $? -ne 0 ]; then
  echo "âŒ Main project code formatting issues found. Run 'npm run format' to fix them."
  exit 1
fi
echo "âœ… Main project Prettier check passed"

# Run TypeScript type checking for main project
echo "ğŸ”§ Running main project TypeScript type checking..."
npm run typecheck
if [ $? -ne 0 ]; then
  echo "âŒ Main project TypeScript type checking failed. Please fix the type errors."
  exit 1
fi
echo "âœ… Main project TypeScript check passed"

# Website subdirectory checks
echo ""
echo "ğŸŒ === WEBSITE SUBDIRECTORY CHECKS ==="
echo "ğŸ“ Switching to website directory"
cd website
echo "ğŸ“ Now in directory: $(pwd)"

# Check if website directory exists and has package.json
if [ ! -f "package.json" ]; then
  echo "âš ï¸  No package.json found in website directory, skipping website checks"
  cd ..
else
  echo "ğŸ“¦ Found package.json in website directory"
  
  # Run linting for website
  echo "ğŸ“ Checking website code style with ESLint..."
  npm run lint
  if [ $? -ne 0 ]; then
    echo "âŒ Website ESLint failed. Please fix the issues before committing."
    cd ..
    exit 1
  fi
  echo "âœ… Website ESLint passed"
  
  # Check code formatting for website
  echo "ğŸ¨ Checking website code formatting with Prettier..."
  npm run format:check
  if [ $? -ne 0 ]; then
    echo "âŒ Website code formatting issues found. Run 'npm run format' in website directory to fix them."
    cd ..
    exit 1
  fi
  echo "âœ… Website Prettier check passed"
  
  # Run TypeScript type checking for website
  echo "ğŸ”§ Running website TypeScript type checking..."
  npx tsc --noEmit
  if [ $? -ne 0 ]; then
    echo "âŒ Website TypeScript type checking failed. Please fix the type errors."
    cd ..
    exit 1
  fi
  echo "âœ… Website TypeScript check passed"
  
  echo "ğŸ“ Returning to main project directory"
  cd ..
fi

echo ""
echo "âœ… All pre-commit checks passed!"
echo "ğŸš€ Ready to commit!"